title: Transport Layer Security 1.3

description: |
  Most relevant patches for TLS 1.3 support in Botan landed between alpha
  release `3.0.0-alpha1` and Botan `3.0.0`. Below is a complete list of those
  patches. Those include preparatory refactorings, additions of TLS 1.3 specific
  protocol implementation and eventually some fixes for bugs that were found
  later in the development.

  Support for TLS 1.1 and older was removed in the early stages of the
  development towards Botan 3.0. As a result, the new TLS 1.3 implementation
  currently co-exists with (D)TLS 1.2 exclusively.

  Patches that add significant protocol implementation code are marked as
  "critical", most notable are GH #2922 and GH #3053 that add most of the client
  and server foundations respectively. Refactorings to prepare the legacy code
  base or cleanups that aim to improve end-user API usability are marked as
  "informational".

  Note that the implementation of TLS 1.3 in Botan 3.0 is not complete. Most
  notably it lacks support for:

  * 0-Round Trip Time handshakes and early data
  * Preshared Keys (PSK) provided out-of-band by the user
  * Raw Public Key authentication (in-lieu of X.509 certificates or PSK)
  * Post-Handshake client authentication

patches:
# Add virtual TLS header  (@lieser)
- pr: 3483  # https://github.com/randombit/botan/pull/3483
  classification: info

# FIX: build with TLS 1.3 disabled  (@reneme)
- pr: 3466  # https://github.com/randombit/botan/pull/3466
  classification: info

# FIX: Session_Manager::find_all() is inefficient  (@reneme)
- pr: 3451  # https://github.com/randombit/botan/pull/3451
  classification: info

# TEST: disable session pruning in SQL manager  (@reneme)
- pr: 3448  # https://github.com/randombit/botan/pull/3448
  classification: info

# Improve locking in TLS::Session_Manager  (@reneme)
- pr: 3450  # https://github.com/randombit/botan/pull/3450
  classification: info

# When m_max_sessions is zero, don't prune the session cache.  (@oviano)
- pr: 3439  # https://github.com/randombit/botan/pull/3439
  classification: info

# [TLS 1.3] Dependency Lifetimes  (@reneme)
- pr: 3409  # https://github.com/randombit/botan/pull/3409
  classification: info

# m_cipher_state may be null in the early stages of handshake  (@oviano)
- pr: 3443  # https://github.com/randombit/botan/pull/3443
  classification: info

# [TLS 1.3] Generalize ephemeral key handling callbacks  (@reneme)
- pr: 3322  # https://github.com/randombit/botan/pull/3322
  classification: critical

# [TLS 1.3] Use TLS::Callbacks::tls_session_established()  (@reneme)
- pr: 3337  # https://github.com/randombit/botan/pull/3337
  classification: info

# Regression Test: trying to reproduce GH #3342  (@reneme)
- pr: 3376  # https://github.com/randombit/botan/pull/3376
  classification: info

# Chore: Enable some more BoGo tests  (@reneme)
- pr: 3365  # https://github.com/randombit/botan/pull/3365
  classification: info

# Chore: Update BoringSSL's test suite to latest master  (@reneme)
- pr: 3364  # https://github.com/randombit/botan/pull/3364
  classification: info

# [TLS 1.3] Cleanup Session Object  (@reneme)
- pr: 3316  # https://github.com/randombit/botan/pull/3316
  classification: info

# [TLS 1.3] Support Session Resumption for TLS Server   (@reneme)
- pr: 3140  # https://github.com/randombit/botan/pull/3140
  classification: critical

# [TLS 1.3] Consolidate the Session Manager  (@reneme)
- pr: 3150  # https://github.com/randombit/botan/pull/3150
  classification: info

# [TLS 1.3] Update Migration Guide  (@reneme)
- pr: 3308  # https://github.com/randombit/botan/pull/3308
  classification: info

# Convert the TLS version enum to an enum class  (@randombit)
- pr: 3312  # https://github.com/randombit/botan/pull/3312
  classification: info

# Change Credentials_Manager::private_key_for to return a shared_ptr  (@randombit)
- pr: 3258  # https://github.com/randombit/botan/pull/3258
  classification: info

# Modify TLS Alert enum names  (@randombit)
- pr: 3246  # https://github.com/randombit/botan/pull/3246
  classification: info

# [TLS 1.3] Prepare for Session Consolidation  (@reneme)
- pr: 3244  # https://github.com/randombit/botan/pull/3244
  classification: info

# FIX: rendering of TLS::Text_Policy::record_size_limit()  (@reneme)
- pr: 3243  # https://github.com/randombit/botan/pull/3243
  classification: info

# Convert TLS::Handshake_Type to an enum class  (@randombit)
- pr: 3240  # https://github.com/randombit/botan/pull/3240
  classification: info

# Make TLS::Record_Type an enum class  (@randombit)
- pr: 3237  # https://github.com/randombit/botan/pull/3237
  classification: info

# Make TLS::Connection_Side an enum class  (@randombit)
- pr: 3235  # https://github.com/randombit/botan/pull/3235
  classification: info

# [TLS 1.3] Support signature_algorithm_cert Extension  (@reneme)
- pr: 3125  # https://github.com/randombit/botan/pull/3125
  classification: critical

# [TLS 1.3] tls_reader benefiting std span usage  (@devnexen)
- pr: 3194  # https://github.com/randombit/botan/pull/3194
  classification: info

# [TLS 1.3] further usage of std::span.  (@devnexen)
- pr: 3187  # https://github.com/randombit/botan/pull/3187
  classification: info

# Use an inner TLS_Data_Reader when decoding TLS extensions  (@randombit)
- pr: 3144  # https://github.com/randombit/botan/pull/3144
  classification: info

# Convert Handshake_Extensions_Type to an enum class  (@randombit)
- pr: 3145  # https://github.com/randombit/botan/pull/3145
  classification: info

# Remove DSA codes from TLS::Signature_Scheme  (@randombit)
- pr: 3143  # https://github.com/randombit/botan/pull/3143
  classification: info

# [TLS 1.3] OCSP Stapling  (@reneme)
- pr: 3112  # https://github.com/randombit/botan/pull/3112
  classification: critical

# [TLS 1.3] Handle KeyUpdate post-handshake message in the Server  (@reneme)
- pr: 3118  # https://github.com/randombit/botan/pull/3118
  classification: critical

# [TLS 1.3] Server honors the Record Size Limit Extension  (@reneme)
- pr: 3116  # https://github.com/randombit/botan/pull/3116
  classification: critical

# [TLS 1.3] ALPN for the server  (@reneme)
- pr: 3117  # https://github.com/randombit/botan/pull/3117
  classification: critical

# [TLS 1.3] Server-Side Client Authentication  (@reneme)
- pr: 3081  # https://github.com/randombit/botan/pull/3081
  classification: critical

# [TLS 1.3] Basic Server Implementation  (@reneme)
- pr: 3053  # https://github.com/randombit/botan/pull/3053
  classification: critical
  comment: |
    This adds most of the foundational server-side mechanics. Most of the
    low-level protocol implementations were added in GH #2922 and reused here.

# [TLS 1.3] Refactor: Prepare for TLS 1.3 Server  (@reneme)
- pr: 3062  # https://github.com/randombit/botan/pull/3062
  classification: info

# [TLS 1.3] Overhaul TLS::Callbacks  (@reneme)
- pr: 2988  # https://github.com/randombit/botan/pull/2988
  classification: info

# [TLS 1.3] Overhaul TLS::Policy  (@reneme)
- pr: 2989  # https://github.com/randombit/botan/pull/2989
  classification: info

# [TLS 1.3] FIX: Record Layer must handle multiple records in compatibility mode  (@reneme)
- pr: 3064  # https://github.com/randombit/botan/pull/3064
  classification: info

# [TLS 1.3] Fuzz Target for Handshake Message Parsing  (@lz101010)
- pr: 3013  # https://github.com/randombit/botan/pull/3013
  classification: info

# [TLS 1.3] Session Resumption  (@reneme)
- pr: 2974  # https://github.com/randombit/botan/pull/2974
  classification: critical

# [TLS 1.3] Client Authentication in the main Handshake  (@hrantzsch)
- pr: 2957  # https://github.com/randombit/botan/pull/2957
  classification: critical

# [TLS 1.3] Limited TLS 1.3 Client Implementation  (@hrantzsch)
- pr: 2922  # https://github.com/randombit/botan/pull/2922
  classification: critical
  comment: |
    This introduces initial support for TLS 1.3 with most of the relevant
    low-level protocol machinery to read/write the wire formats. Before this was
    merged, a number of other patches prepared the existing TLS 1.2 code base to
    co-exist. Actual protocol-level changes were first introduced in this patch.

# Introduce TLS::Callbacks::tls_current_timestamp()  (@reneme)
- pr: 2976  # https://github.com/randombit/botan/pull/2976
  classification: info

# [TLS 1.3] Preparations for addition of TLS 1.3  (@reneme)
- pr: 2946  # https://github.com/randombit/botan/pull/2946
  classification: info

# [TLS 1.3] Extract Handshake_Transitions from Handshake_State  (@reneme)
- pr: 2947  # https://github.com/randombit/botan/pull/2947
  classification: info

# [TLS 1.3] Additional convenience methods for TLS_Data_Reader  (@reneme)
- pr: 2948  # https://github.com/randombit/botan/pull/2948
  classification: info

# [TLS 1.3] Build Module Configuration  (@reneme)
- pr: 3468  # https://github.com/randombit/botan/pull/3468
  classification: info

# Public TLS API uses std::span  (@reneme)
- pr: 3363  # https://github.com/randombit/botan/pull/3363
  classification: info
